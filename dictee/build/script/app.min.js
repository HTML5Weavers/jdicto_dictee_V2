var MSG_ERREUR_SECTION="Erreur : aucune section définie";var MSG_VOIX_SYNTHESE_DECOUVERTE="découverte (voix de synthèse)";var MSG_VOIX_DECOUVERTE="découverte";var MSG_VOIX_SYNTHESE_ENTRAINEMENT="entrainement (voix de synthèse)";var MSG_VOIX_ENTRAINEMENT="entrainement";var MSG_DICTAM="dictée aménagée";var MSG_PREFERENCES="Les préférences ont été appliquées.";var MSG_CORRECTION_MOT_EN_TROP="Un mot/espace en trop a été saisi ou un mot a été découpé à tort. ";var MSG_CORRECTION_MOTS_EN_TROP=" mots/espaces en trop ont été saisis ou des mots ont été découpés à tort. ";var MSG_SIGNE_EN_TROP="<br />Il peut aussi s'agir d'un signe de ponctuation séparé à tort du mot qui le précède.";var MSG_CORRECTION_INDISPONIBLE="(Correction non disponible : pour une explication, voir le message ci-dessus.)";var MSG_BRAVO="Bravo !";var MSG_CAR=" caractère";var MSG_CARS=" caractères";var MSG_MOT="mot";var MSG_MOTS="mots";var MSG_MANQUE="Il manque ";var MSG_MOTS_DECOUPES=" ou certains mots doivent être découpés. ";var MSG_SIGNE_COLLE="<br />Il peut aussi s'agir d'un signe de ponctuation collé à tort au mot qui le précède.";var MSG_TON_TEXTE="Ton texte comporte ";var MSG_ERREUR=" erreur";var MSG_TEXTE_COMPLET="Texte complet :";var MSG_PHRASE="Phrase ";var MSG_NUMERO_DICTEE="Tu dois d'abord sélectionner une dictée dans le sommaire (<i class='material-icons'>home</i>).";var MSG_FIC_INCOMPATIBLE="Le fichier de données n'a pas le bon format : ";var MSG_AUCUN_TEXTE="Tu voudrais afficher une correction, mais aucun texte n'a été saisi.<br />Pour saisir ton texte : <kbd>menu <i class='material-icons'>menu</i> : <i class='material-icons'>edit</i> saisir ";var MSG_ERREUR_DECOUPAGE="Erreur de découpage de l'enregistrement. Fragment audio inconnu.";var MSG_ERREUR_PARTAGE="Tu tentes de partager une dictée à partir d'une application locale. Le partage n'est pas disponible dans ce cas.";var MSG_ERREUR_SOMMAIRE="Le sommaire n'est pas au bon format.";var MSG_ERREUR_INCONNUE="Erreur non définie pour le numéro : ";var MSG_TXT_CM="Texte à choix multiples : recopie ce texte sur ton cahier de brouillon en tenant compte des choix proposés entre crochets : <span class='evidence'>{ }</span>";var $=new class ${set(id){this.id=document.getElementById(id)}montrer(){this.id.style.display="block"}montrer_en_ligne(){this.id.style.display="inline"}masquer(){this.id.style.display="none"}cliquer(){this.id.click()}set_classe(classeCSS){this.id.className=classeCSS}set_texte(texte){this.id.textContent=texte}maj_texte(texte){this.id.textContent+=texte}set_html(texte){this.id.innerHTML=texte}maj_html(texte){this.id.innerHTML+=texte}set_valeur(valeur){this.id.value=valeur}get_texte(){return this.id.textContent}get_html(){return this.id.innerHTML}get_valeur(){return this.id.value}};var q$=new class q${set(el){this.el=document.querySelector(el)}montrer(){this.el.style.display="block"}montrer_en_ligne(){this.el.style.display="inline"}masquer(){this.el.style.display="none"}cliquer(){this.el.click()}set_classe(classeCSS){this.el.className=classeCSS}set_texte(texte){this.el.textContent=texte}set_html(texte){this.el.innerHTML=texte}maj_html(texte){this.el.innerHTML+=texte}};loadData("data/version.json",chargerVersion);loadData("data/sommaire.json",chargeSommaire);adapteLibelles();window.addEventListener("load",function(){document.getElementById("menu").addEventListener("click",function(){$.set("barre_actions");$.masquer();$.set("menu_sommaire");$.masquer();$.set("menu_vertical");$.montrer();masquerLesSections()},false);document.getElementById("sommaire").addEventListener("click",function(){$.set("menu_vertical");$.masquer();afficherSommaire()},false);var sommaires=new Array("cm2","6e","5e","4e","3e");sommaires.forEach(function(niv){document.getElementById("sommaire_"+niv).addEventListener("click",function(){replierSommaire();deplierReplierNiveauSommaire(niv)},false)});replierSommaire();var items_aide=new Array("1","2","3");items_aide.forEach(function(niv){document.getElementById("aide_"+niv).addEventListener("click",function(){replierContenusAide();deplierReplierContenuAide(niv)},false)});replierContenusAide();document.getElementById("aide").addEventListener("click",function(){$.set("menu_vertical");$.masquer();$.set("menu_sommaire");$.masquer();afficherAide()},false);document.getElementById("partage").addEventListener("click",function(){$.set("menu_vertical");$.masquer();$.set("menu_sommaire");$.masquer();if(atonChargeUneDictee()){afficherPartage()}else{masquerLesSections();erreur(1)}},false);document.getElementById("onglet_aide").addEventListener("click",function(){afficherArticle("aide")},false);$.set("onglet_aide");$.cliquer();document.getElementById("onglet_licence").addEventListener("click",function(){afficherArticle("licence")},false);document.getElementById("onglet_illustrations").addEventListener("click",function(){afficherArticle("illustrations")},false);var caracteres=document.querySelectorAll(".spec");caracteres.forEach(function(caractere){caractere.addEventListener("click",function(){var carspec=caractere.textContent;insertion(carspec)},false)});document.getElementById("editeur").addEventListener("input",function(){compteurMAJ("A")},false);var editeur=document.getElementById("editeur");addListenerMulti(editeur,"mousedown mouseup keydown keyup",maj_curseur,false);var items=["item1","item2","item3","item4","item5","item6"];items.forEach(function(item){document.getElementById(item).addEventListener("click",function(){$.set("menu_vertical");$.masquer();masquerLesSections();$.set("barre_actions");$.masquer();var section="section_"+item;afficherSection(section);switch(section){case"section_item1":if(atonChargeUneDictee()){afficherSelecteur();definitActionBouton("D",fd,true)}else{masquerLesSections();erreur(1)}break;case"section_item2":if(atonChargeUneDictee()){document.getElementById("editeur").addEventListener("input",function(){compteurMAJ("A")},false);definitActionBouton("A",fa,true);definitActionBouton("B",fb,true);compteurMAJ()}else{masquerLesSections();erreur(1)}break;case"section_item3":if(atonChargeUneDictee()){$.set("nombre");var nombre=$.get_texte();if(nombre==="0"){masquerLesSections();erreur(3)}else{definitActionBouton("C",fc,true)}}else{masquerLesSections();erreur(1)}break;case"section_item4":if(atonChargeUneDictee()){afficherSolution()}else{masquerLesSections();erreur(1)}break;case"section_item5":if(atonChargeUneDictee()){definitActionBouton("H",fh,true)}else{masquerLesSections();erreur(1)}break;case"section_item6":if(atonChargeUneDictee()){definitActionBouton("F",ff,true)}else{masquerLesSections();erreur(1)}break;default:afficherMessage(MSG_ERREUR_SECTION,"erreur")}},false)});var numero;numero=obtenirParametre("numero");if(numero){loadData("data/dictee"+numero+".json",chargerDonnees);afficherSelecteur();afficherSolution();$.set("item6");$.cliquer()}else{$.set("sommaire");$.cliquer()}listeVoix();document.querySelector("input[name=debit]").addEventListener("change",changeDebit,false);document.getElementById("police_editeur").addEventListener("change",prefEditeur,false);document.getElementById("voix").addEventListener("change",choisirVoix,false);document.getElementById("changer_modalite").addEventListener("click",function(){$.set("item5");$.cliquer()},false);document.getElementById("decouverte").addEventListener("change",function(){$.set("modalite_choisie");$.set_texte(MSG_VOIX_SYNTHESE_DECOUVERTE);afficherSelecteur();afficherSolution();document.getElementById("lire").addEventListener("click",ecouterDictee,false)},false);document.getElementById("decouverte_audio").addEventListener("change",function(){$.set("modalite_choisie");$.set_texte(MSG_VOIX_DECOUVERTE);afficherSelecteur();afficherSolution();document.getElementById("lire_audio").addEventListener("click",ecouterDicteeAudio,false)},false);document.getElementById("entrainement").addEventListener("change",function(){$.set("modalite_choisie");$.set_texte(MSG_VOIX_SYNTHESE_ENTRAINEMENT);afficherSelecteur();afficherSolution();document.getElementById("lire").addEventListener("click",ecouterDictee,false)},false);document.getElementById("entrainement_audio").addEventListener("change",function(){$.set("modalite_choisie");$.set_texte(MSG_VOIX_ENTRAINEMENT);afficherSelecteur();afficherSolution();document.getElementById("lire_audio").addEventListener("click",ecouterDicteeAudio,false)},false);$.set("entrainement");$.cliquer();$.set("decouverte_audio");$.cliquer();document.getElementById("dictee_amenagee").addEventListener("change",function(){$.set("modalite_choisie");$.set_texte(MSG_DICTAM);afficherSelecteur();afficherSolution()},false);document.getElementById("bouton_fermer_message").addEventListener("click",masquerMessage,false);$.set("corps");$.set_classe("chargement")},false);function afficherSection(section){$.set(section);$.montrer();masquerBoutonsAction();masquerSommaire()}function masquerLesSections(){let sections=document.querySelectorAll("section");sections.forEach(function(section){section.style.display="none"})}function revenir(num_section){$.set("item"+num_section);$.cliquer()}function afficherMessage(texte,type="information"){$.set("section_message");$.set_classe(type);$.set("bouton_fermer_message");$.montrer();$.set("contenu_message");$.set_html(texte);$.set("section_message");$.montrer()}function masquerMessage(){$.set("section_message");$.masquer()}function masquerBoutonsAction(){var boutons=document.querySelectorAll("#actions li");boutons.forEach(function(bouton){bouton.style.display="none"})}function afficherActions(){var barreActions=document.getElementById("barre_actions");if(barreActions.style.display==="none"){barreActions.style.display="block"}}function definitActionBouton(indice,f,montrer=true){afficherActions();var bouton,item;bouton=document.querySelector("#"+indice+">a");item=document.getElementById(indice);bouton.addEventListener("click",f,false);montrer===true?item.style.display="inline":item.style.display="none"}function fa(){afficherErreurs(3)}function fb(){effacerEditeur()}function fc(){revenir(2);definitActionBouton("A",fa,true);definitActionBouton("B",fb,true);compteurMAJ();masquerMessage()}function fd(){revenir(6)}function fe(){$.set("item2");$.cliquer()}function ff(){revenir(1)}function fg(){revenir(1);masquerMessage()}function fh(){finPreferences()}function fi(){$.set("partage");$.cliquer()}function fj(){$.set("item6");$.cliquer()}function loadData(url,cFunction){var xhttp;xhttp=new XMLHttpRequest;xhttp.addEventListener("error",function(){erreur(1)},false);xhttp.open("GET",url+(/\?/.test(url)?"&":"?")+(new Date).getTime(),true);xhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){cFunction(this)}};xhttp.send(null)}function chargerDonnees(xhttp){var donnees;donnees=JSON.parse(xhttp.responseText);var app_name=donnees.app_name;if(app_name==="jDicto"){$.set("prof");$.set_texte(donnees.prof);$.set("reference");$.set_texte(donnees.reference);$.set("titre");$.set_texte(donnees.titre);$.set("auteur");$.set_texte(donnees.auteur);$.set("ouvrage");$.set_texte(donnees.ouvrage);if(donnees.legal!==undefined){$.set("legal");$.set_texte(donnees.legal)}$.set("solution");$.set_texte(donnees.texte)}else{erreur(2)}}function chargerAudioDictee(xhttp){var donnees;donnees=JSON.parse(xhttp.responseText);var media="media/dictee"+donnees.dictee+".ogg";$.set("texte");var phrase=$.get_valeur();var segments=donnees.segments;var dernier=segments.length;var lecteur_audio=document.getElementById("lecteur_audio");if(phrase>dernier){erreur(4);return}var numero=obtenirParametre("numero");if(numero){switch(phrase){case 0:uri=media;break;default:uri=media+"#t="+segments[phrase-1]}lecteur_audio.src=uri;lecteur_audio.load()}}function chargerDicteeAmenagee(xhttp){var donnees=JSON.parse(xhttp.responseText);var dictam=donnees.dictam;dictam=replaceAll(dictam,"10",donnees.mot10);dictam=replaceAll(dictam,"1",donnees.mot1);dictam=replaceAll(dictam,"2",donnees.mot2);dictam=replaceAll(dictam,"3",donnees.mot3);dictam=replaceAll(dictam,"4",donnees.mot4);dictam=replaceAll(dictam,"5",donnees.mot5);dictam=replaceAll(dictam,"6",donnees.mot6);dictam=replaceAll(dictam,"7",donnees.mot7);dictam=replaceAll(dictam,"8",donnees.mot8);dictam=replaceAll(dictam,"9",donnees.mot9);dictam=replaceAll(dictam,"{","<span class='evidence'>{</span>");dictam=replaceAll(dictam,"}","<span class='evidence'>}</span>");dictam=replaceAll(dictam,"|","<span class='evidence'>|</span>");var reg=new RegExp(/\n/g);dictam=dictam.replace(reg,"<br />");$.set("dictam");$.set_html(dictam)}function chargerVersion(xhttp){var donnees=JSON.parse(xhttp.responseText);var version=donnees.version;$.set("app_version");$.set_texte(version)}function chargeSommaire(xhttp){var donnees=JSON.parse(xhttp.responseText);var nom_app=donnees.app_name;if(nom_app.toLowerCase()!=="jdicto"){erreur(6)}else{var niveaux=donnees.niveaux;niveaux.forEach(function(niv){var liste_niv=document.getElementById(niv);var donnees_niv=chargeDonneesSectionSommaire(xhttp,niv);var nombreEnfants=document.getElementById(niv).childNodes.length;var nombre_niv=donnees_niv.length;$.set("nb_"+niv);$.set_texte("("+nombre_niv+")");if(nombre_niv){donnees_niv.forEach(function(dn){var item=document.createElement("li");var lien=document.createElement("a");var textnode=document.createTextNode("Dictée "+dn);lien.appendChild(textnode);lien.href="#";lien.id=dn;item.appendChild(lien);liste_niv.appendChild(item);document.getElementById(lien.id).addEventListener("click",function(){sessionStorage.setItem("numero",lien.id);loadData("data/dictee"+lien.id+".json",chargerDonnees);window.location.reload(true)},false)})}replierSommaire()})}}function chargeDonneesSectionSommaire(xhttp,niv){var donnees=JSON.parse(xhttp.responseText);switch(niv){case"cm2":return donnees.niv_cm2;break;case"6e":return donnees.niv_6e;break;case"5e":return donnees.niv_5e;break;case"4e":return donnees.niv_4e;break;case"3e":return donnees.niv_3e;break;default:return false;break}}function replierSommaire(){var niveaux=new Array("cm2","6e","5e","4e","3e");niveaux.forEach(function(niveau){$.set(niveau);$.masquer();$.set("sommaire_"+niveau);$.set_classe("replie")})}function deplierReplierNiveauSommaire(niv){var item=document.getElementById(niv);var parent=document.getElementById("sommaire_"+niv);if(item.style.display==="none"){item.style.display="block";parent.className="deplie"}else{item.style.display="none";parent.className="replie"}}function afficherSommaire(){masquerLesSections();masquerBoutonsAction();$.set("menu_sommaire");$.montrer()}function masquerSommaire(){$.set("menu_sommaire");$.masquer()}function obtenirParametre(cle){var params=new URLSearchParams(window.location.search);if(params.has(cle)){var valeur=params.get(cle);sessionStorage.setItem(cle,valeur);document.location.href=window.location.origin;return valeur}else{if(sessionStorage.getItem(cle)){return sessionStorage.getItem(cle)}else{return false}}}function atonChargeUneDictee(){var numero=obtenirParametre("numero");return numero}function insertion(car){$.set("editeur");var texte=$.get_valeur();$.set("curseur");var curseur=$.get_texte();var sous_chaine_un=texte.substring(0,curseur);var sous_chaine_deux=texte.substring(curseur,texte.length);texte=sous_chaine_un+car+sous_chaine_deux;$.set("editeur");$.set_valeur(texte);compteurMAJ("A");set_position_curseur(parseInt(curseur)+1);$.set("curseur");$.set_texte(parseInt(curseur)+1)}function compteurMAJ(){$.set("editeur");var nombre=$.get_valeur().length;$.set("nombre");$.set_texte(nombre);switch(nombre){case 0:$.set("A");$.masquer();$.set("B");$.masquer();$.set("libelle_car");$.set_texte(MSG_CAR);break;case 1:$.set("B");$.montrer_en_ligne();$.set("A");$.montrer_en_ligne();$.set("libelle_car");$.set_texte(MSG_CAR);break;default:$.set("A");$.montrer_en_ligne();$.set("B");$.montrer_en_ligne();$.set("libelle_car");$.set_texte(MSG_CARS)}}function effacerEditeur(){$.set("editeur");$.set_valeur("");compteurMAJ("A")}function get_position_curseur(){var positionCurseur=0;var zone=document.getElementById("editeur");positionCurseur=zone.selectionStart;return positionCurseur}function set_position_curseur(position=0){var el=document.getElementById("editeur");el.selectionEnd=position;el.focus()}function maj_curseur(){var pos_curseur=get_position_curseur();$.set("curseur");$.set_texte(pos_curseur)}function finPreferences(){adapteLibelles();revenir(1);afficherMessage(MSG_PREFERENCES);window.setTimeout(masquerMessage,1500)}function choisirVoix(){var indice_voix=document.getElementById("voix").selectedIndex;var nom_voix=document.getElementById("voix").options[indice_voix].text;$.set("ma_voix");$.set_texte(indice_voix);$.set("nom_voix");$.set_texte(nom_voix)}function prefEditeur(){var police=document.getElementById("police_editeur");var editeur=document.getElementById("editeur");police.checked===true?editeur.className="cursive":editeur.className="standard"}function adapteLibelles(){$.set("modalite_choisie");var modalite=$.get_texte();if(modalite==="dictée aménagée"){$.set("item1");$.set_html("<i class='material-icons'>playlist_add_check</i>&nbsp;Choisir…");q$.set("#section_item1 h1");q$.set_html("<i class='material-icons'>playlist_add_check</i>&nbsp;Choisir…")}else{$.set("item1");$.set_html("<i class='material-icons'>headset</i>&nbsp;Écouter…");q$.set("#section_item1 h1");q$.set_html("<i class='material-icons'>headset</i>&nbsp;Écouter…")}}function listeVoix(){var s=document.getElementById("voix");var interval=setInterval(function(){var voices=speechSynthesis.getVoices();if(voices.length)clearInterval(interval);else return;for(var i=0;i<voices.length;i++){var option=document.createElement("option");s.appendChild(option);option.value=i;option.textContent=voices[i].name}},10)}function comparerTextes(attendu,saisi){var bilan=new Array;var message="";var bouton="C";var erreurs=0;var type="attention";var resultat="";var retours=new Array;$.set("texte");var indice=$.get_valeur();if(parseInt(indice)===0){var reg=new RegExp(/\n/g);attendu=attendu.replace(reg," <br /> ");saisi=saisi.replace(reg," <br /> ")}var reg2=new RegExp(/\s+/g);var mots_attendus=attendu.split(reg2);var mots_saisis=saisi.split(reg2);var nombre_attendus=mots_attendus.length;var nombre_saisis=mots_saisis.length;var difference=nombre_attendus-nombre_saisis;if(difference<0){if(Math.abs(difference)===1){message=MSG_CORRECTION_MOT_EN_TROP}else{message=Math.abs(difference)+MSG_CORRECTION_MOTS_EN_TROP}message+=MSG_SIGNE_EN_TROP;type="erreur";bouton="C";resultat=MSG_CORRECTION_INDISPONIBLE}else if(difference===0){message=MSG_BRAVO;type="succes";bouton="G";for(var i=0;i<nombre_attendus;i++){if(mots_saisis[i]===mots_attendus[i]){resultat+=mots_saisis[i]+" "}else{resultat+="<s>"+mots_saisis[i]+"</s> ";erreurs++;bouton="C"}}resultat=resultat.replace(" @ ","<br />")}else{var mot=MSG_MOT;difference>1?mot=MSG_MOTS:mot=MSG_MOT;message=MSG_MANQUE+difference+" "+mot+MSG_MOTS_DECOUPES;message+=MSG_SIGNE_COLLE;type="erreur";bouton="C";resultat=MSG_CORRECTION_INDISPONIBLE}if(erreurs){var terminaison="";switch(erreurs){case 1:terminaison=terminaison;break;default:terminaison="s"}message=MSG_TON_TEXTE+erreurs+MSG_ERREUR+terminaison+".";type="erreur";bouton="C"}bilan[0]=resultat;bilan[1]=message;bilan[2]=type;bilan[3]=bouton;return bilan}function afficherErreurs(num_section){$.set("editeur");var saisi=$.get_valeur();$.set("solution");var attendu=$.get_texte();$.set("texte");var indice=$.get_valeur();var sous_titre=MSG_TEXTE_COMPLET;if(indice>0){attendu=extrairePhrase(attendu,indice);sous_titre=MSG_PHRASE+indice+" :"}var correction=document.querySelector("#section_item"+num_section+" p");var reponse=comparerTextes(attendu,saisi);masquerLesSections();afficherSection("section_item"+num_section);afficherMessage(reponse[1],reponse[2]);correction.innerHTML="<em>"+sous_titre+"</em><br /><br />"+reponse[0];var bouton=reponse[3];switch(bouton){case"G":definitActionBouton("G",fg,true);break;default:definitActionBouton("C",fc,true)}}function afficherSolution(){$.set("solution");var attendu=$.get_texte();$.set("texte");var indice=$.get_valeur();var sous_titre="<em>"+MSG_TEXTE_COMPLET+"</em><br /><br />";if(indice>0){attendu=extrairePhrase(attendu,indice);var sous_titre="<em>"+MSG_PHRASE+indice+"</em><br /><br />"}var reg=new RegExp(/\n/g);attendu=attendu.replace(reg,"<br />");$.set("solution_affichee");$.set_html(sous_titre+attendu)}function direPonctuation(texte){var signes=new Array(".","!","?",";",":",",","…","«","»","—","(",")");var prononciations=new Array("POINT","POINT D'EXCLAMATION","POINT D'INTERROGATION","POINT-VIRGULE","DEUX POINTS","VIRGULE","POINTS DE SUSPENSION","OUVREZ LES GUILLEMETS","FERMEZ LES GUILLEMETS","TIRET CADRATIN","OUVREZ LA PARENTHÈSE","FERMEZ LA PARENTHÈSE");for(var i=0;i<signes.length;++i){texte=replaceAll(texte,signes[i],signes[i]+" ["+prononciations[i]+"] ")}texte=replaceAll(texte,"\n"," [RETOUR À LA LIGNE]. ");return texte}function ecouterDictee(){$.set("solution");var texte=$.get_texte();$.set("texte");var indice=$.get_valeur();if(indice>0){texte=extrairePhrase(texte,indice)}var ponctuation=document.getElementById("ponctuation").checked;ponctuation===true?texte=direPonctuation(texte):true;var dictee=new SpeechSynthesisUtterance(texte);var voices=speechSynthesis.getVoices();$.set("ma_voix");var ma_voix=$.get_texte();if(ma_voix.length===0){dictee.lang="fr-FR"}else{dictee.voice=voices[ma_voix]}$.set("mon_debit");var rate=$.get_texte();dictee.rate=rate;dictee.pitch=1.2;document.getElementById("pause").addEventListener("click",function(){speechSynthesis.pause();document.getElementById("lire").addEventListener("click",function(){speechSynthesis.resume()},false)});document.getElementById("fin").addEventListener("click",function(){speechSynthesis.cancel()},false);speechSynthesis.speak(dictee);dictee.addEventListener("end",function(){definitActionBouton("E",fe,true)},false)}function ecouterDicteeAudio(){$.set("solution");var texte=$.get_texte();$.set("texte");var indice=$.get_valeur();if(indice>0){texte=extrairePhrase(texte,indice)}document.getElementById("pause_audio").addEventListener("click",function(){document.getElementById("lecteur_audio").pause();document.getElementById("lire_audio").addEventListener("click",function(){document.getElementById("lecteur_audio").play()},false)},false);document.getElementById("fin_audio").addEventListener("click",function(){document.getElementById("lecteur_audio").load();definitActionBouton("E",fe,true)},false);document.getElementById("lecteur_audio").play();document.getElementById("lecteur_audio").addEventListener("ended",function(){definitActionBouton("E",fe,true)},false)}function changeDebit(){document.getElementById("mon_debit").textContent=document.querySelector("input[name=debit]").value}function afficherSelecteur(){$.set("modalite_choisie");var modalite=$.get_texte();var numero=obtenirParametre("numero");switch(modalite){case"entrainement (voix de synthèse)":$.set("selecteur_phrase");$.set_texte("Toutes les phrases");$.set("texte");$.set_valeur(0);$.set("phrase");$.set_texte("Texte complet");$.set("info_saisie");$.set_texte("Texte complet :");afficherSolution();effacerEditeur();$.set("voix_enregistree");$.masquer();$.set("dictam");$.masquer();$.set("voix_de_synthese");$.montrer();break;case"entrainement":$.set("selecteur_phrase");$.set_texte("Toutes les phrases");$.set("texte");$.set_valeur(0);$.set("phrase");$.set_texte("Texte complet");$.set("info_saisie");$.set_texte("Texte complet :");afficherSolution();effacerEditeur();if(numero){loadData("data/clip"+numero+".json",chargerAudioDictee)}$.set("voix_de_synthese");$.masquer();$.set("dictam");$.masquer();$.set("voix_enregistree");$.montrer();break;case"découverte (voix de synthèse)":$.set("solution");var texte=$.get_texte();var nombre=extrairePhrase(texte,0);var selecteur="";for(var i=1;i<nombre+1;i++){selecteur+=' | <a href="#" class="phrase" id="'+i+'">'+i+"</a>"}selecteur+=" |";$.set("selecteur_phrase");$.set_html(selecteur);for(var i=1;i<nombre+1;i++){document.getElementById(i).addEventListener("click",function(){$.set("phrase");$.set_texte("Phrase "+this.id);$.set("info_saisie");$.set_texte("Phrase "+this.id);$.set("texte");$.set_valeur(this.id);afficherSolution();effacerEditeur()},false);$.set("phrase");$.set_texte("Phrase 1");$.set("texte");$.set_valeur(1);afficherSolution()}$.set("dictam");$.masquer();$.set("voix_enregistree");$.masquer();$.set("voix_de_synthese");$.montrer();break;case"dictée aménagée":$.set("selecteur_phrase");$.set_html(MSG_TXT_CM);$.set("texte");$.set_valeur(0);$.set("phrase");$.set_texte("Dictée aménagée");$.set("info_saisie");$.set_texte("Dictée aménagée :");afficherSolution();effacerEditeur();if(numero){loadData("data/dictam"+numero+".json",chargerDicteeAmenagee)}$.set("voix_de_synthese");$.masquer();$.set("voix_enregistree");$.masquer();$.set("dictam");$.montrer();break;case"découverte":default:$.set("solution");var texte=$.get_texte();var nombre=extrairePhrase(texte,0);var selecteur="";for(var i=1;i<nombre+1;i++){selecteur+=' | <a href="#" class="phrase" id="'+i+'">'+i+"</a>"}selecteur+=" |";$.set("selecteur_phrase");$.set_html(selecteur);for(var i=1;i<nombre+1;i++){document.getElementById(i).addEventListener("click",function(){$.set("phrase");$.set_texte("Phrase "+this.id);$.set("info_saisie");$.set_texte("Phrase "+this.id);$.set("texte");$.set_valeur(this.id);afficherSolution();effacerEditeur();if(numero){loadData("data/clip"+numero+".json",chargerAudioDictee)}},false);$.set("phrase");$.set_texte("Phrase 1");$.set("texte");$.set_valeur(1);afficherSolution();if(numero){loadData("data/clip"+obtenirParametre("numero")+".json",chargerAudioDictee)}}$.set("voix_de_synthese");$.masquer();$.set("voix_enregistree");$.montrer()}}function extrairePhrase(texte,indice){texte=texte.replace(/[!]\s/gmu,"!*");texte=texte.replace(/[?]\s/gmu,"?*");texte=texte.replace(/[.]\s/gmu,".*");var phrases=texte.split("*");var nombre=phrases.length;phrases.unshift(nombre);return phrases[indice]}function escapeRegExp(str){return str.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function replaceAll(str,find,replace){return str.replace(new RegExp(escapeRegExp(find),"g"),replace)}function addListenerMulti(element,liste_events,fonction){liste_events.split(" ").forEach(function(e){element.addEventListener(e,fonction,false)})}function afficherAide(){masquerLesSections();masquerBoutonsAction();$.set("section_aide_licence");$.montrer()}function replierContenusAide(){var niveaux=new Array("1","2","3");niveaux.forEach(function(niveau){$.set("contenu_aide_"+niveau);$.masquer();$.set("aide_"+niveau);$.set_classe("replie")})}function deplierReplierContenuAide(niv){var item=document.getElementById("contenu_aide_"+niv);var parent=document.getElementById("aide_"+niv);if(item.style.display==="none"){item.style.display="block";parent.className="deplie"}else{item.style.display="none";parent.className="replie"}}function masquerLesArticles(){var articles=document.querySelectorAll("article");articles.forEach(function(art){art.style.display="none"})}function afficherArticle(article){masquerLesArticles();$.set("article_"+article);$.montrer()}function afficherLienPartage(){var url=window.location.href;if(url.indexOf("localhost")===7||url.indexOf("chrome-extension")===0){erreur(5)}else{var numero=obtenirParametre("numero");url=url.replace("#","");url+="?numero="+numero;$.set("lien");$.set_texte(url);$.set("section_partage");$.montrer()}}function afficherPartage(){masquerLesSections();masquerBoutonsAction();if(atonChargeUneDictee()){afficherLienPartage()}else{erreur(1)}}function erreur(numero){var message="Erreur "+numero+" - ";switch(numero){case 1:message+=MSG_NUMERO_DICTEE;break;case 2:message+=MSG_FIC_INCOMPATIBLE;message+=" 'dictee"+obtenirParametre("numero")+".json'.";break;case 3:message+=MSG_AUCUN_TEXTE;break;case 4:message+=MSG_ERREUR_DECOUPAGE;break;case 5:message+=MSG_ERREUR_PARTAGE;break;case 6:message+=MSG_ERREUR_SOMMAIRE;break;default:message=MSG_ERREUR_INCONNUE+numero}afficherMessage(message,"erreur")}